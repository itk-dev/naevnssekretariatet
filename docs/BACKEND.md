# Backend

For handling our backend needs such as settings, we make use of the
[EasyAdmin-bundle](https://github.com/EasyCorp/EasyAdminBundle) for Symfony.

The backend can be accessed at <http://project.url/admin>.

## Structure and naming conventions

The [EasyAdmin documentation](https://symfony.com/doc/current/bundles/EasyAdminBundle/index.html)
suggests a structure wherein you can place your controllers and custom templates.
We follow that suggestion, and this section will show the basics
from the Easy Admin documentation.

If you are in doubt on where to place your files,
and this section does not give you an answer, you should follow the [EasyAdmin documentation](https://symfony.com/doc/current/bundles/EasyAdminBundle/index.html).

### Controllers

All controllers part of the backend should be placed in the
controllers/admin folder:

```sh
/project_root
  /src
    /Controllers
      /Admin
        SomeCrudController.php
```

Crud controllers should be named after the entity it manages and suffixed with CrudController.php.
For example a crud controller for a User entity, should be named UserCrudController.php.

EasyAdmin provides a console command for making crud controllers,
and it's recommended to use that command:

```sh
docker compose exec phpfpm bin/console make:admin:crud
```

For more information see EasyAdmins documentation about [CRUD controllers](https://symfony.com/doc/current/bundles/EasyAdminBundle/crud.html).

### Templates

To get the autogenerated EasyAdmin backend to have the same look and feel
as our frontend, we override a number of EasyAdmin templates. Our custom
templates should be placed in the templates/bundles/EasyAdminBundle directory:

```sh
/project_root
  /templates
    /bundles
      /EasyAdminBundle
        layout.html.twig // This template overrides the EasyAdmin layout template
```

## Adding pages to the backend

For adding items to the main menu,
you'll add a menu item in the configureMenuItems method of the admin/DashboardController.php

```php
class DashboardController extends AbstractDashboardController
{
    // ...

    public function configureMenuItems(): iterable
    {
        yield MenuItem::linktoDashboard('Dashboard', 'fa fa-home');
        // yield MenuItem::linkToCrud('The Label', 'fas fa-list', EntityClass::class);
    }
}
```

Our current theme doesn't support nested menu items, so the following will not render
a menu item:

```php
class DashboardController extends AbstractDashboardController
{
    // ...

    public function configureMenuItems(): iterable
    {
        MenuItem::subMenu('Blog', 'fa fa-article')->setSubItems([
            MenuItem::linkToCrud('Categories', 'fa fa-tags', Category::class),
            MenuItem::linkToCrud('Posts', 'fa fa-file-text', BlogPost::class),
            MenuItem::linkToCrud('Comments', 'fa fa-comment', Comment::class),
        ]),
        // ...
    }
}
```

See the EasyAdmin documentation [about the main menu in the dashboard](https://symfony.com/doc/current/bundles/EasyAdminBundle/dashboards.html#main-menu).

## Useful links

* [EasyAdmin documentation](https://symfony.com/doc/current/bundles/EasyAdminBundle/index.html)
* [CRUD controllers](https://symfony.com/doc/current/bundles/EasyAdminBundle/crud.html)
* [Main menu in the dashboard](https://symfony.com/doc/current/bundles/EasyAdminBundle/dashboards.html#main-menu)
